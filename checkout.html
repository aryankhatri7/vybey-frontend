<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>VYBEY | Secure Checkout</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
<link rel="stylesheet" href="style.css">

<style>
/* ===== Checkout Layout ===== */
.checkout-wrapper{
  max-width: 1200px;
  margin: auto;
}

.checkout-box{
  background: rgba(255,255,255,0.04);
  border-radius: 18px;
  padding: 28px;
  border: 1px solid rgba(255,255,255,0.06);
  box-shadow: 0 30px 60px rgba(0,0,0,0.35);
}

/* Headings */
.checkout-title{
  font-size: 26px;
  font-weight: 500;
  letter-spacing: 0.5px;
}

/* Order summary */
.summary-item{
  display:flex;
  justify-content:space-between;
  font-size:14px;
  padding:8px 0;
  border-bottom:1px dashed rgba(255,255,255,0.12);
}

.summary-total{
  font-size:18px;
  font-weight:600;
  margin-top:16px;
}

/* Inputs */
.checkout-box input,
.checkout-box textarea,
.checkout-box select{
  background: rgba(0,0,0,0.35);
  border:1px solid rgba(255,255,255,0.12);
  color:#fff;
  border-radius:10px;
  font-size:14px;
}

.checkout-box input:focus,
.checkout-box textarea:focus,
.checkout-box select:focus{
  outline:none;
  box-shadow:none;
  border-color:var(--accent);
  background: rgba(0,0,0,0.45);
}

/* Button */
.place-order-btn{
  background: var(--accent);
  border:none;
  border-radius:999px;
  padding:14px;
  font-size:15px;
  letter-spacing:0.5px;
  box-shadow:0 12px 30px rgba(154,123,95,0.4);
  transition:all .35s ease;
}

.place-order-btn:hover{
  transform:translateY(-2px);
  box-shadow:0 18px 45px rgba(154,123,95,0.55);
}

/* Success msg */
#success-msg{
  font-size:14px;
}
</style>
</head>

<body>

<!-- ===== Navbar ===== -->
<nav class="navbar">
  <div class="logo"><a href="index.html">VYBEY</a></div>
  <ul class="nav-links">
    <li><a href="index.html">Home</a></li>
    <li><a href="#">Products</a></li>
    <li><a href="#">About</a></li>
  </ul>
  <div class="cart-icon">
    <a href="cart.html">üëú <span id="cart-count">0</span></a>
  </div>
</nav>

<!-- ===== Checkout ===== -->
<section class="container my-5">
  <div class="checkout-wrapper">

    <h2 class="text-center mb-5 checkout-title">Secure Checkout</h2>

    <div class="row g-4">

      <!-- Order Summary -->
      <div class="col-md-5">
        <div class="checkout-box">
          <h5 class="mb-3">Order Summary</h5>

          <div id="checkout-cart"></div>

          <div class="summary-total d-flex justify-content-between">
            <span>Total</span>
            <span>‚Çπ<span id="checkout-total">0</span></span>
          </div>
        </div>
      </div>

      <!-- Customer Details -->
      <div class="col-md-7">
        <div class="checkout-box">
          <h5 class="mb-3">Customer Details</h5>

          <form id="checkout-form">
            <div class="mb-3">
              <label class="form-label">Name</label>
              <input type="text" id="name" class="form-control" readonly required>
            </div>

            <div class="mb-3">
              <label class="form-label">Phone</label>
              <input type="number" id="phone" class="form-control" required>
            </div>

            <div class="mb-3">
              <label class="form-label">Delivery Address</label>
              <textarea id="address" rows="3" class="form-control" required></textarea>
            </div>

            <div class="mb-4">
              <label class="form-label">Payment Method</label>
              <select id="payment" class="form-control">
                <option value="COD">Cash on Delivery</option>
              </select>
            </div>

            <button type="submit" class="btn place-order-btn w-100">
              Place Order ‚Üí
            </button>
          </form>

          <div id="success-msg" class="mt-3 text-success"></div>
        </div>
      </div>

    </div>
  </div>
</section>

<!-- ===== Footer ===== -->
<footer class="footer">
  <div class="footer-container">
    <div class="footer-section">
      <h3>VYBEY</h3>
      <p>Accessories made for Gen-Z.<br>Wear your vibe.</p>
    </div>
    <div class="footer-section">
      <h4>Quick Links</h4>
      <ul><li>Home</li><li>Shop</li><li>Categories</li><li>Contact</li></ul>
    </div>
    <div class="footer-section">
      <h4>Support</h4>
      <ul><li>FAQs</li><li>Returns</li><li>Privacy Policy</li><li>Terms & Conditions</li></ul>
    </div>
    <div class="footer-section">
      <h4>Follow Us</h4>
      <div class="social-icons"><span>üì∑</span><span>üê¶</span><span>‚ñ∂Ô∏è</span></div>
    </div>
  </div>
  <p class="copyright">¬© 2026 VYBEY.IN ‚Äî All Rights Reserved</p>
</footer>

<!-- ===== JS (UNCHANGED) ===== -->
<script>
/* ================= LOGIN CHECK ================= */
const user = JSON.parse(localStorage.getItem("user"));
if (!user) {
    alert("Please login to place order");
    window.location.href = "login.html";
}

/* ================= AUTO FILL NAME ================= */
document.getElementById("name").value = user.name;

/* ================= LOAD CART ================= */
let cart = JSON.parse(localStorage.getItem('cart')) || [];
cart = cart.map((item, index) => ({
    id: item.id || `old_${index}`,
    name: item.name || "Unknown Product",
    price: item.price || 0,
    image: item.image || "https://via.placeholder.com/300",
    quantity: item.quantity || 1
}));
localStorage.setItem('cart', JSON.stringify(cart));

/* ================= RENDER CART ================= */
function renderCheckoutCart() {
    const container = document.getElementById('checkout-cart');
    container.innerHTML = '';
    let total = 0;

    if (cart.length === 0) {
        container.innerHTML = '<p>Your cart is empty üòî</p>';
    }

    cart.forEach(item => {
        total += item.price * item.quantity;
        container.innerHTML += `
          <div class="summary-item">
            <span>${item.name} √ó ${item.quantity}</span>
            <span>‚Çπ${item.price * item.quantity}</span>
          </div>
        `;
    });

    document.getElementById('checkout-total').innerText = total;
}
renderCheckoutCart();

/* ================= CART COUNT ================= */
function updateCartCount() {
    let count = cart.reduce((sum, item) => sum + item.quantity, 0);
    document.getElementById('cart-count').innerText = count;
}
updateCartCount();

/* ================= PLACE ORDER ================= */
document.getElementById('checkout-form').addEventListener('submit', async (e) => {
    e.preventDefault();

    if (cart.length === 0) {
        alert("Your cart is empty!");
        return;
    }

    const order = {
        userId: user.id,
        userName: user.name,
        userEmail: user.email,
        name: user.name,
        phone: document.getElementById('phone').value,
        address: document.getElementById('address').value,
        paymentMethod: document.getElementById('payment').value,
        items: cart,
        total: cart.reduce((sum, item) => sum + item.price * item.quantity, 0)
    };

    try {
        const res = await fetch('http://localhost:5000/api/orders/add', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(order)
        });

        if (res.ok) {
            localStorage.removeItem('cart');
            document.getElementById('success-msg').innerText = "‚úÖ Order placed successfully!";
            setTimeout(() => window.location.href = "index.html", 2000);
        } else {
            alert("Something went wrong!");
        }
    } catch (err) {
        console.error(err);
        alert("Server error!");
    }
});
</script>

</body>
</html>
